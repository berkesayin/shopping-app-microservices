# Extract Elastic's E-Commerce Data To Product Index

Elastic's sample e-commerce data contains products, categories, customers and orders information. For this project, `product`, `category` and `customer` data is extracted to new `Elasticsearch indices` to utilize for different functionalities. 

![img](./img/4.product-data-elasticsearch.png)

### Create Product Index 

Open `Kibana Server` &rarr; `Management` &rarr; `Dev Tools` and run this command.

```json 
PUT /product
{
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 1,
    "analysis": {
      "analyzer": {
        "autocomplete_analyzer": {
          "filter": [
            "lowercase"
          ],
          "tokenizer": "edge_ngram_tokenizer"
        }
      },
      "tokenizer": {
        "edge_ngram_tokenizer": {
          "type": "edge_ngram",
          "min_gram": 2,
          "max_gram": 15,
          "token_chars": [
            "letter",
            "digit"
          ]
        }
      }
    }
  },
  "mappings": {
    "dynamic": "strict",
    "properties": {
      "base_price": {
        "type": "scaled_float",
        "scaling_factor": 100
      },
      "category": {
        "properties": {
          "id": {
            "type": "keyword"
          },
          "name": {
            "type": "text",
            "fields": {
              "keyword": {
                "type": "keyword"
              }
            }
          }
        }
      },
      "created_on": {
        "type": "date"
      },
      "manufacturer": {
        "type": "text",
        "fields": {
          "keyword": {
            "type": "keyword"
          }
        }
      },
      "min_price": {
        "type": "scaled_float",
        "scaling_factor": 100
      },
      "product_id": {
        "type": "integer"
      },
      "product_name": {
        "type": "text",
        "fields": {
          "autocomplete": {
            "type": "text",
            "analyzer": "autocomplete_analyzer",
            "search_analyzer": "standard"
          },
          "keyword": {
            "type": "keyword"
          }
        }
      },
      "sku": {
        "type": "keyword"
      },
      "status": {
        "type": "boolean"
      }
    }
  }
}
```

Response:

```json 
{
  "acknowledged": true,
  "shards_acknowledged": true,
  "index": "product"
}
```

Add `Data View` for this `product` index. For that go to `Kibana Server` &rarr; `Discover`. And create a new `Data View` here:

- Name: `product`
- Index pattern: `product` 
- Timestamp field: `created_on` 

These are fields for `product` index:

- base_price 
- category.id 
- category.name 
- created_on 
- manufacturer 
- min_price 
- product_id 
- product_name 
- sku 
- status

Meta fields: 

- _id 
- _ignored 
- _index 
- _score

### Product Data 

There is a [Spring Boot project](https://github.com/berkesayin/product-data-elasticsearch) to have `product` index and `category` index with documents at `Elasticsearch`. Clone it.

```sh 
git clone https://github.com/berkesayin/product-data-elasticsearch.git
```

Locate to the project at terminal.

```sh
cd /path/to/product-data-elasticsearch
```

Create a `.env` file at root of the project. And put your values.

```
ELASTICSEARCH_USERNAME=<your_elastic_user>
ELASTICSEARCH_PASSWORD=<your_elastic_password>
```

This is `application.yml` file:

```yml
spring:
  application:
    name: product-data
elasticsearch:
  username: ${ELASTICSEARCH_USERNAME}
  password: ${ELASTICSEARCH_PASSWORD}
extract:
  products:
    enabled: true
  categories:
    enabled: false
```

### Extract Product Data

- The application will automatically extract and process `product` data if the `extract.products.enabled` property is set to `true` in `application.yml`.

- Make sure your `Elasticsearch` instance is running on `localhost:9200`. 

Build the project.

```sh 
mvn clean install
```

Run the project.

```sh 
mvn spring-boot:run
```

Products are extracted from Elastic's `sample eCommerce orders data` and indexed to `product` index at `Elasticsearch`. It can be viewed ad `product` data view at `Kibana`.