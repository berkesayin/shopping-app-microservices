# Fleet And Elastic Agent

`Kibana` instance is configured earlier to use `Fleet Server` with `xpack.fleet.outputs` setting at `kibana.yml` file. 

Add `Fleet Server` for the project. For that go to `Kibana Server` &rarr; `Management` &rarr; `Fleet`. 

![img](./img/9.fleet-server-kibana.png)

At `Settings` tab, these are the default configurations that can stay same for beginning.

- Name: `default` 
- Type: `Elasticsearch` 
- Hosts: `https://localhost:9200`
- Default: `Agent integrations, agent monitoring` 

### Elastic Agent

- `Elastic Agent` is a single, unified way to add monitoring for logs, metrics, and other types of data to a host.
- It can also protect hosts from security threats, query data from operating systems, forward data from remote services or hardware, and more. 
- A single `agent` makes it easier and faster to deploy monitoring across infrastructure. 
- Each `agent` has a single policy that can be updated to add `integrations` for new data sources, security protections, and more.

### Fleet 

- `Fleet` provides a web-based UI in `Kibana` for centrally managing `Elastic Agents` and their `policies`.
- `Fleet Server` is the mechanism to connect `Elastic Agents` to `Fleet`.  
- All communication between the `Fleet UI` and `Fleet Server` happens through `Elasticsearch`. 
- `Fleet` writes policies, actions, and any changes to the `fleet-*` indices in `Elasticsearch`. 
- Each `Fleet Server` monitors the indices, picks up changes, and ships them to the `Elastic Agents`. 

So, `Fleet Server` is manager, and `Elastic Agent` is for data collection.

### Set Up Elastic Agent and Fleet Server 

For that go to `Kibana Server` &rarr; `Management` &rarr; `Fleet`  &rarr; `Add Agent`  &rarr; `Enroll in Fleet`  &rarr; `Add Fleet Server`  &rarr; `Quick Start` 

- Name: `fleet-server-dev`
- URL: `https://localhost:8220`

Then, click `Generate Fleet Server policy`. With this, `Fleet server policy` and `service token` are generated. Host configured at `https://localhost:8220`. 

### Install Fleet Server To A Centralized Host 

At terminal, locate to where you want to install and use this command. This is for `Mac` system. Refer the installation docs if you use other systems. 

```sh 
curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.17.4-darwin-aarch64.tar.gz
tar xzvf elastic-agent-8.17.4-darwin-aarch64.tar.gz
cd elastic-agent-8.17.4-darwin-aarch64
sudo ./elastic-agent install \
  --fleet-server-es=https://localhost:9200 \
  --fleet-server-service-token=<fleet_server_service_token> \
  --fleet-server-policy=fleet-server-policy \
  --fleet-server-es-ca-trusted-fingerprint=<fleet_server_es_ca_trusted_fingerprint> \
  --fleet-server-port=8220
```

Use your values for `fleet_server_service_token`and `fleet_server_es_ca_trusted_fingerprint`.

This command installs `Elastic Agent` on the `host system` and enrolls in `Fleet Server`.

![img](./img/10.fleet-server-kibana.png)
